<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quáº£n lÃ½ GPA & Äiá»ƒm rÃ¨n luyá»‡n</title>
  <link rel="icon" type="image/png" href="images/bee1.svg">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h2 {
      background: #007bff;
      color: white;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }

    h3 {
      margin-top: 24px;
      color: #007bff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-bottom: 16px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);

    }

    th, td {
      padding: 20px;
      border-bottom: 1px solid #ccc;
      min-width: 80px;
      text-align: center;
      font-size: 20px;
    }

    th {
      background: #f7f9fb;
    }

    input[type="text"], input[type="number"], input[type="file"] {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
      box-sizing: border-box;
      text-align: center;
      font-size: 20px;
    }

    button {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 5px;
    }

    button:hover {
      background-color: #218838;
    }

    td img {
      margin-top: 4px;
      border-radius: 4px;
      max-width: 50px;
      height: auto;
    }

    .danger {
      background-color: #dc3545;
    }

    .danger:hover {
      background-color: #c82333;
    }

    #gpaAccum, #totalRL {
      color: #dc3545;
      font-weight: bold;
    }

    #rank {
      font-weight: bold;
      color: #007bff;
    }

    .minh-chung {
      max-width: 150px;
    }

    .activity-btns {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    
    .proof-display img {
  transition: all 0.3s ease;
  cursor: pointer;
}

td[contenteditable="true"] {
    font-size: 30px !important;
    padding: 50px;
}
  </style>
</head>


<body>

</div>

<!-- Thanh nÃºt cá»‘ Ä‘á»‹nh -->
  <div id="fixedButtons" style="
    position: fixed; 
    top: 0; left: 0; right: 0; 
    background: #f8f8f8; 
    padding: 10px; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    z-index: 9999;
    display: flex;
    justify-content: center;
    gap: 15px;
  ">
    <button onclick="saveAllData(true)">ğŸ’¾ LÆ°u dá»¯ liá»‡u</button>
    <button onclick="loadAllData()">ğŸ”„ Táº£i láº¡i dá»¯ liá»‡u</button>
  </div>

  <!-- Pháº§n ná»™i dung chÃ­nh -->
  <div style="padding-top: 60px;"> <!-- padding-top báº±ng hoáº·c lá»›n hÆ¡n chiá»u cao div nÃºt -->
    <!-- Pháº§n GPA vÃ  Ä‘iá»ƒm rÃ¨n luyá»‡n cá»§a báº¡n náº±m Ä‘Ã¢y -->
  </div>



<h2 style="font-size: 40px;">ğŸ“Pháº§n tÃ­nh GPA</h2>

<table id="gpaTable">
  <thead>
    <tr>
      <th style="width: 40px;">STT</th>
      <th>MÃ´n</th>
      <th style="width: 60px;">Sá»‘ TC</th>
      <th style="width: 60px;">Äiá»ƒm QT</th>
      <th style="width: 60px;">Äiá»ƒm CK</th>
      <th style="width: 60px;">Tá»‰ lá»‡ QT (%)</th>
      <th style="width: 60px;">ÄTB (10)</th>
      <th style="width: 60px;">ÄTB (4)</th>
      <th style="width: 60px;">ÄTB (Chá»¯)</th>
      <th style="width: 60px;">XÃ³a</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<button onclick="addSubject()">â•ThÃªm mÃ´n</button>

<p STYLE="font-size: 25PX;"><strong>ğŸ“ŠGPA tÃ­ch lÅ©y:</strong> <span id="gpaAccum">0.00</span> / 4.00</p>

<p STYLE="font-size: 25PX;"><strong>ğŸ…Xáº¿p loáº¡i:</strong> <span id="rank">KhÃ´ng</span></p>


<hr>

<h2 style="font-size: 40px;">ğŸ†Pháº§n tÃ­nh Ä‘iá»ƒm rÃ¨n luyá»‡n</h2>
<p style="font-size: 25px;"><strong>Tá»•ng Ä‘iá»ƒm:</strong> <span id="totalRL">0</span></p>
<div class="activity-btns">
  <button onclick="addActivityTo(0)">â• Hoáº¡t Ä‘á»™ng Äiá»u 1</button>
  <button onclick="addActivityTo(1)">â• Hoáº¡t Ä‘á»™ng Äiá»u 2</button>
  <button onclick="addActivityTo(2)">â• Hoáº¡t Ä‘á»™ng Äiá»u 3</button>
  <button onclick="addActivityTo(3)">â• Hoáº¡t Ä‘á»™ng Äiá»u 4</button>
</div>
<div id="rlContainer"></div>


<script>
function addSubject() {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td class="stt">1</td>
    <td><input type="text" onchange="autoSave()"></td>
    <td><input type="number" value="3" onchange="calculateGPA(); autoSave()"></td>
    <td><input type="number" value="0" onchange="calculateGPA(); autoSave()"></td>
    <td><input type="number" value="0" onchange="calculateGPA(); autoSave()"></td>
    <td><input type="number" value="50" onchange="calculateGPA(); autoSave()"></td>
    <td></td>
    <td></td>
    <td></td>
    <td><button class="danger" onclick="this.parentElement.parentElement.remove(); calculateGPA(); updateSubjectSTT(); autoSave()">X</button></td>
  `;
  document.querySelector("#gpaTable tbody").appendChild(row);
  updateSubjectSTT();
  calculateGPA();
  autoSave();
}

function updateSubjectSTT() {
  const rows = document.querySelectorAll("#gpaTable tbody tr");
  rows.forEach((row, index) => {
    const sttCell = row.querySelector(".stt");
    if (sttCell) sttCell.innerText = index + 1;
  });
}

function calculateGPA() {
  let total4 = 0, totalCredits = 0;

  document.querySelectorAll("#gpaTable tbody tr").forEach(row => {
    const cells = row.children;
    const tc = parseFloat(cells[2].querySelector("input").value) || 0;
    const qt = parseFloat(cells[3].querySelector("input").value) || 0;
    const ck = parseFloat(cells[4].querySelector("input").value) || 0;
    const ratioQT = parseFloat(cells[5].querySelector("input").value) || 0;
    const ratioCK = 100 - ratioQT;

    const avg10 = ((qt * ratioQT + ck * ratioCK) / 100).toFixed(2);
    const avg4 = convertTo4(avg10);
    const letter = convertToLetter(avg10);

    cells[6].innerText = avg10;
    cells[7].innerText = avg4.toFixed(1);
    cells[8].innerText = letter;

    total4 += avg4 * tc;
    totalCredits += tc;
  });

  const gpa = totalCredits > 0 ? (total4 / totalCredits).toFixed(2) : "0.00";
  document.getElementById("gpaAccum").innerText = gpa;
  document.getElementById("rank").innerText = rankGPA(gpa);
  updateSubjectSTT();
}

function convertTo4(score) {
  score = parseFloat(score);
  if (score >= 8.5) return 4;
  if (score >= 8.0) return 3.5;
  if (score >= 7.0) return 3;
  if (score >= 6.5) return 2.5;
  if (score >= 5.5) return 2;
  if (score >= 5.0) return 1.5;
  if (score >= 4.0) return 1;
  return 0;
}

function convertToLetter(score) {
  score = parseFloat(score);
  if (score >= 9.0) return "A+";
  if (score >= 8.5) return "A";
  if (score >= 8.0) return "B+";
  if (score >= 7.0) return "B";
  if (score >= 6.5) return "C+";
  if (score >= 5.5) return "C";
  if (score >= 5.0) return "D+";
  if (score >= 4.0) return "D";
  return "F";
}

function rankGPA(gpa) {
  gpa = parseFloat(gpa);
  if (gpa >= 3.6) return "ğŸ‘‘ Xuáº¥t sáº¯c";
  if (gpa >= 3.2) return "ğŸ†Giá»i";
  if (gpa >= 2.5) return "ğŸ¥ˆKhÃ¡";
  if (gpa >= 2.0) return "ğŸ¥‰Trung bÃ¬nh";
  return "ğŸ˜¢Yáº¿u";
}



// --- RÃ¨n luyá»‡n ---
const rlTitles = [
  { title: "Ã thá»©c há»c táº­p", max: 20 },
  { title: "RÃ¨n luyá»‡n Ä‘áº¡o Ä‘á»©c", max: 25 },
  { title: "Tham gia hoáº¡t Ä‘á»™ng", max: 20 },
  { title: "Quan há»‡ vá»›i cá»™ng Ä‘á»“ng", max: 25 }
];

const rlContainer = document.getElementById("rlContainer");

rlTitles.forEach((item, i) => {
  const section = document.createElement("div");
  section.classList.add("rl-section");
  section.dataset.index = i; // Ä‘á»ƒ tiá»‡n truy cáº­p sau

  section.innerHTML = `
    <h3 style="font-size: 20px;">
      ğŸ¯Äiá»u ${i + 1}: ${item.title} â€” 
      <span class="rl-score">0 / ${item.max}</span>
    </h3>
    <table>
      <thead>
        <tr>
          <th style="width: 40px;">STT</th>
          <th>Hoáº¡t Ä‘á»™ng</th>
          <th style="width: 60px;">Äiá»ƒm</th>
          <th style="width: 600px;">ğŸ”—Link</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>`;
  rlContainer.appendChild(section);
});

function addActivityTo(index) {
  const tbody = rlContainer.children[index].querySelector("tbody");
  const row = document.createElement("tr");
  row.innerHTML = `
    <td class="stt-rl"></td>
    <td><input type="text" onchange="autoSave()"></td>
    <td><input type="number" value="0" onchange="calcRL(); autoSave()"></td>
    <td>
      <input type="text" class="minh-chung" placeholder="Link minh chá»©ng" onchange="showProofLink(this); autoSave()">
      <div class="proof-display"></div>
    </td>
    <td><button class="danger" onclick="this.parentElement.parentElement.remove(); calcRL(); updateRLSTT(${index}); autoSave()">X</button></td>
  `;
  tbody.appendChild(row);
  calcRL();
  updateRLSTT(index);
  autoSave();
}

function updateRLSTT(index) {
  const tbody = rlContainer.children[index].querySelector("tbody");
  const rows = tbody.querySelectorAll("tr");
  rows.forEach((row, i) => {
    row.querySelector(".stt-rl").innerText = i + 1;
  });
}

function calcRL() {
  let total = 0;

  rlContainer.querySelectorAll(".rl-section").forEach((section, i) => {
    const max = rlTitles[i].max;
    let sectionTotal = 0;

    section.querySelectorAll("tbody tr").forEach(row => {
      const score = parseFloat(row.children[2].querySelector("input").value) || 0;
      sectionTotal += score;
    });

    // --- HIá»‚N THá»Š ÄIá»‚M THá»°C Táº¾ TRÃŠN Tá»ªNG ÄIá»€U ---
    // Hiá»ƒn thá»‹ sectionTotal (tá»•ng Ä‘iá»ƒm nháº­p) / max (Ä‘iá»ƒm tá»‘i Ä‘a)
    section.querySelector(".rl-score").innerText = `${sectionTotal} / ${max}`;

    // --- LOGIC TÃNH Tá»”NG ÄIá»‚M CUá»I CÃ™NG: VáºªN GIá»šI Háº N THEO MAX ---
    // Äiá»ƒm dÃ¹ng Ä‘á»ƒ cá»™ng vÃ o tá»•ng cuá»‘i cÃ¹ng sáº½ Ä‘Æ°á»£c giá»›i háº¡n khÃ´ng vÆ°á»£t quÃ¡ max
    const finalSectionScoreForTotal = Math.min(sectionTotal, max); 
    total += finalSectionScoreForTotal; 
  });

  document.getElementById("totalRL").innerText = total;
}


// Hiá»ƒn thá»‹ minh chá»©ng áº£nh hoáº·c link
function showProofLink(input) {
  const container = input.nextElementSibling;
  const link = input.value.trim();
  container.innerHTML = "";

  if (!link) return;

  if (link.match(/\.(jpeg|jpg|png|gif|webp)$/i)) {
    const img = document.createElement("img");
    img.src = link;
    img.style.maxWidth = "200px";
    img.style.borderRadius = "8px";
    img.style.marginTop = "6px";
    container.appendChild(img);
  } else {
    const a = document.createElement("a");
    a.href = link;
    a.innerText = "ğŸ”— Xem minh chá»©ng"; 
    a.target = "_blank";
    a.style.color = "#007bff";
    a.style.display = "inline-block";
    a.style.marginTop = "6px";
    container.appendChild(a);
  }
}

// HÃ m lÆ°u dá»¯ liá»‡u tá»± Ä‘á»™ng gá»i khi cÃ³ thay Ä‘á»•i
function autoSave() {
  saveAllData(false); // KhÃ´ng alert khi tá»± lÆ°u
}

// LÆ°u toÃ n bá»™ dá»¯ liá»‡u vÃ o localStorage
function saveAllData(showAlert = true) {
  const gpaData = [];
  document.querySelectorAll("#gpaTable tbody tr").forEach(row => {
    const inputs = row.querySelectorAll("input");
    gpaData.push({
      subject: inputs[0].value,
      credits: inputs[1].value,
      qt: inputs[2].value,
      ck: inputs[3].value,
      ratioQT: inputs[4].value
    });
  });

  const rlData = [];
  rlContainer.querySelectorAll(".rl-section").forEach(section => {
    const activities = [];
    section.querySelectorAll("tbody tr").forEach(row => {
      const inputs = row.querySelectorAll("input");
      activities.push({
        name: inputs[0].value,
        score: inputs[1].value,
        proof: inputs[2].value
      });
    });
    rlData.push(activities);
  });

  localStorage.setItem("gpaData", JSON.stringify(gpaData));
  localStorage.setItem("rlData", JSON.stringify(rlData));

  if (showAlert) alert("ÄÃ£ lÆ°u dá»¯ liá»‡u!");
}

// Táº£i dá»¯ liá»‡u tá»« localStorage
function loadAllData() {
  const gpaData = JSON.parse(localStorage.getItem("gpaData") || "[]");
  const rlData = JSON.parse(localStorage.getItem("rlData") || "[]");

  const tbody = document.querySelector("#gpaTable tbody");
  tbody.innerHTML = "";
  gpaData.forEach(item => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="stt">1</td>
      <td><input type="text" onchange="autoSave()" value="${item.subject}"></td>
      <td><input type="number" value="${item.credits}" onchange="calculateGPA(); autoSave()"></td>
      <td><input type="number" value="${item.qt}" onchange="calculateGPA(); autoSave()"></td>
      <td><input type="number" value="${item.ck}" onchange="calculateGPA(); autoSave()"></td>
      <td><input type="number" value="${item.ratioQT}" onchange="calculateGPA(); autoSave()"></td>
      <td></td><td></td><td></td>
      <td><button class="danger" onclick="this.parentElement.parentElement.remove(); calculateGPA(); updateSubjectSTT(); autoSave()">X</button></td>
    `;
    tbody.appendChild(row);
  });

  // Load RL data
  rlData.forEach((sectionActivities, i) => {
    const tbodyRL = rlContainer.children[i].querySelector("tbody");
    tbodyRL.innerHTML = "";
    sectionActivities.forEach(act => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td class="stt-rl"></td>
        <td><input type="text" onchange="autoSave()" value="${act.name}"></td>
        <td><input type="number" value="${act.score}" onchange="calcRL(); autoSave()"></td>
        <td>
          <input type="text" class="minh-chung" placeholder="Link minh chá»©ng" onchange="showProofLink(this); autoSave()" value="${act.proof}">
          <div class="proof-display"></div>
        </td>
        <td><button class="danger" onclick="this.parentElement.parentElement.remove(); calcRL(); updateRLSTT(${i}); autoSave()">X</button></td>
      `;
      tbodyRL.appendChild(row);
      showProofLink(row.querySelector(".minh-chung"));
    });
    updateRLSTT(i);
  });

  updateSubjectSTT();
  calculateGPA();
  calcRL();

  alert("ÄÃ£ táº£i dá»¯ liá»‡u!");
}

window.onload = () => {
  loadAllData();
}
</script>


</body>
</html>
