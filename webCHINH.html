<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Web Ch·∫•m B√†i</title>
  <link rel="icon" type="image/png" href="check.svg" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fdf4ff;
      color: #4b0082;
      padding: 20px;
    }

    h2 {
      color: #7e57c2;
      margin-bottom: 10px;
    }

    .section {
      background-color: #f3e5f5;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #6a1b9a;
    }

    input[type="number"],
    input[type="text"] {
      padding: 8px 12px;
      border: 1px solid #ce93d8;
      border-radius: 10px;
      outline: none;
      width: 100%;
      margin-bottom: 10px;
      background-color: #f8eafc;
      color: #4a148c;
    }

    td input[type="text"] {
  width: 80px; /* üëà ho·∫∑c ƒëi·ªÅu ch·ªânh nh·ªè h∆°n t√πy th√≠ch */
  padding: 6px 10px;
  border: 1px solid #ce93d8;
  border-radius: 10px;
  background-color: #f8eafc;
  color: #4a148c;
  text-align: center;
  box-sizing: border-box;
}

#answerForm {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-top: 10px;
}

.answer-table {
  flex: 1 1 300px;
  border-collapse: collapse;
}

.answer-table th,
.answer-table td {
  border: 1px solid #ce93d8;
  padding: 8px;
  text-align: center;
  background-color: #fce4ec;
  color: #6a1b9a;
}

.answer-table th {
  background-color: #e1bee7;
}

td input[type="text"] {
  width: 80px;
  padding: 6px 10px;
  border: 1px solid #ce93d8;
  border-radius: 10px;
  background-color: #f8eafc;
  color: #4a148c;
  text-align: center;
  box-sizing: border-box;
}

    input[type="file"] {
      display: none;
    }

    .file-upload {
      display: inline-block;
      padding: 8px 16px;
      background-color: #d1c4e9;
      border-radius: 12px;
      color: #4a148c;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    button {
      background-color: #ba68c8;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 10px 16px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #ab47bc;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ce93d8;
      padding: 10px;
      text-align: center;
      background-color: #fce4ec;
      color: #6a1b9a;
    }

    th {
      background-color: #e1bee7;
    }

    #result {
      margin-top: 20px;
      padding: 15px;
      background-color: #ede7f6;
      border-radius: 12px;
      font-weight: bold;
      color: #4a148c;
    }
  </style>
</head>
<body>
  <div class="section">
    <h2><i class="fas fa-edit"></i> üìù Ph·∫ßn B√†i L√†m</h2>
    <label for="numQuestions">üî¢ S·ªë c√¢u h·ªèi:</label>
    <input type="number" id="numQuestions" min="1" placeholder="Nh·∫≠p s·ªë c√¢u" />
    <button onclick="generateAnswerSheet()"><i class="fas fa-table"></i> ‚ú® T·∫°o b·∫£ng</button>
    <form id="answerForm"></form>
  </div>

  <div class="section">
    <h2><i class="fas fa-file-import"></i> üì• Ph·∫ßn ƒê√°p √Ån</h2>
    <label class="file-upload">
      <i class="fas fa-upload"></i> Ch·ªçn file Excel
      <input type="file" id="excelFile" accept=".xlsx, .xls" />
    </label>
    <div id="fileNameDisplay"></div>
    <div style="margin-top: 10px">
      <label for="pointPerCorrect">üéØ ƒêi·ªÉm m·ªói c√¢u ƒë√∫ng:</label>
      <input type="number" id="pointPerCorrect" value="1" step="0.1" placeholder="VD: 0.5, 1..." />
    </div>
    <button onclick="generateCorrectAnswerTable()"><i class="fas fa-table"></i> üìã T·∫°o b·∫£ng ƒë√°p √°n</button>
    <form id="correctAnswerForm" style="margin-top: 10px;"></form>

    <button onclick="gradeAnswers()"><i class="fas fa-check-circle"></i> ‚úÖ Ch·∫•m b√†i</button>
    <div id="result" style="display: none;"><i class="fas fa-chart-line"></i> <span id="resultText"></span></div>
  </div>

  <script>
    let correctAnswers = {};

    function generateAnswerSheet() {
  const form = document.getElementById('answerForm');
  const num = parseInt(document.getElementById('numQuestions').value);
  form.innerHTML = '';

  const table = document.createElement('table');
  table.className = 'answer-table';

  const sttRow = document.createElement('tr');
  const ansRow = document.createElement('tr');

  let count = 0;

  for (let i = 1; i <= num; i++) {
    const sttCell = document.createElement('td');
    sttCell.textContent = i;
    sttRow.appendChild(sttCell);

    const ansCell = document.createElement('td');
    ansCell.innerHTML = `<input type="text" name="answer_${i}" maxlength="10" placeholder="Nh·∫≠p ƒë√°p √°n" />`;
    ansRow.appendChild(ansCell);

    count++;

    if (count === 5 || i === num) {
      table.appendChild(sttRow.cloneNode(true));
      table.appendChild(ansRow.cloneNode(true));
      count = 0;
      sttRow.innerHTML = '';
      ansRow.innerHTML = '';
    }
  }

  form.appendChild(table);
}



    document.getElementById('excelFile').addEventListener('change', function (e) {
  const file = e.target.files[0];
  if (!file) return;
  document.getElementById('fileNameDisplay').textContent = `üìÇ ƒê√£ ch·ªçn: ${file.name}`;
  const reader = new FileReader();

  reader.onload = function (e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });

    correctAnswers = {};

    if (json.length === 0) {
      alert('‚ö†Ô∏è File Excel tr·ªëng.');
      return;
    }

    // Ki·ªÉm tra chi·ªÅu ngang: 2 d√≤ng, d√≤ng 1 l√† s·ªë c√¢u, d√≤ng 2 l√† ƒë√°p √°n
    if (json.length >= 2 && json[0].length > 0 && typeof json[0][0] !== 'undefined') {
      const firstRow = json[0];
      const secondRow = json[1];

      const isHorizontal = firstRow.every(q => typeof q !== 'undefined' && q !== null && q.toString().trim() !== '') &&
                           secondRow.every(a => typeof a !== 'undefined' && a !== null && a.toString().trim() !== '');

      if (isHorizontal) {
        for (let i = 0; i < firstRow.length; i++) {
          const qNum = firstRow[i];
          const ans = secondRow[i];
          if (qNum && ans) {
            correctAnswers[qNum.toString().trim()] = ans.toString().trim().toUpperCase();
          }
        }
        alert('‚úÖ T·∫£i ƒë√°p √°n th√†nh c√¥ng (üìè chi·ªÅu ngang)');
        return;
      }
    }

    // M·∫∑c ƒë·ªãnh x·ª≠ l√Ω theo chi·ªÅu d·ªçc: m·ªói d√≤ng l√† c·∫∑p [c√¢u, ƒë√°p √°n]
    for (let row of json) {
      for (let i = 0; i < row.length; i += 2) {
        const qNum = row[i];
        const ans = row[i + 1];
        if (qNum && ans) {
          correctAnswers[qNum.toString().trim()] = ans.toString().trim().toUpperCase();
        }
      }
    }
    alert('‚úÖ T·∫£i ƒë√°p √°n th√†nh c√¥ng (üìê chi·ªÅu d·ªçc)');
  };

  reader.readAsArrayBuffer(file);
});

      
    function gradeAnswers() {
  let correct = 0;
  let total = 0;
  let totalScore = 0;
  const pointPerCorrect = parseFloat(document.getElementById('pointPerCorrect').value) || 1;

  const numQuestions = parseInt(document.getElementById('numQuestions').value);
  correctAnswers = {}; // reset l·∫°i tr∆∞·ªõc m·ªói l·∫ßn ch·∫•m

  // ‚úÖ L·∫•y ƒë√°p √°n t·ª´ b·∫£ng nh·∫≠p tay (n·∫øu c√≥)
  for (let i = 1; i <= numQuestions; i++) {
    const input = document.getElementById(`correct_${i}`);
    if (input && input.value.trim() !== '') {
      correctAnswers[i.toString()] = input.value.trim().toUpperCase();
    }
  }

  // ‚úÖ So s√°nh t·ª´ng c√¢u tr·∫£ l·ªùi
  for (let i = 1; i <= numQuestions; i++) {
    const qNum = i.toString();
    const answerInput = document.querySelector(`input[name="answer_${qNum}"]`);
    const correctAns = correctAnswers[qNum];

    if (answerInput && correctAns) {
      total++;
      const userAns = answerInput.value.trim().toUpperCase();

      if (userAns === correctAns) {
        answerInput.style.backgroundColor = '#e0f2f1'; // xanh nh·∫°t
        correct++;
        totalScore += pointPerCorrect;
      } else {
        answerInput.style.backgroundColor = '#ffebee'; // ƒë·ªè nh·∫°t
      }
    }
  }

  // ‚úÖ Hi·ªÉn th·ªã k·∫øt qu·∫£ cu·ªëi
  const resultBox = document.getElementById('result');
  const resultText = document.getElementById('resultText');
  resultBox.style.display = 'flex';
  resultText.innerText = `‚úÖ K·∫øt qu·∫£: ${correct}/${total} c√¢u ƒë√∫ng. üåü T·ªïng ƒëi·ªÉm: ${totalScore}`;
}



function generateCorrectAnswerTable() {
  const form = document.getElementById('correctAnswerForm');
  const num = parseInt(document.getElementById('numQuestions').value);
  if (!num || num <= 0) {
    alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë c√¢u h·ªèi tr∆∞·ªõc!");
    return;
  }

  form.innerHTML = '';

  const table = document.createElement('table');
  table.className = 'answer-table';

  let sttRow = document.createElement('tr');
  let ansRow = document.createElement('tr');

  let count = 0;

  for (let i = 1; i <= num; i++) {
    const sttCell = document.createElement('td');
    sttCell.textContent = i;
    sttRow.appendChild(sttCell);

    const ansCell = document.createElement('td');
    const input = document.createElement('input');
    input.type = 'text';
    input.id = `correct_${i}`;
    input.maxLength = 10;
    input.placeholder = 'Nh·∫≠p ƒë√°p √°n';
    ansCell.appendChild(input);
    ansRow.appendChild(ansCell);

    count++;

    // M·ªói 5 c·ªôt ho·∫∑c h·∫øt th√¨ th√™m h√†ng v√†o b·∫£ng
    if (count === 5 || i === num) {
      table.appendChild(sttRow);
      table.appendChild(ansRow);
      sttRow = document.createElement('tr');
      ansRow = document.createElement('tr');
      count = 0;
    }
  }

  form.appendChild(table);
}


</script>


  </script>
</body>
</html>
