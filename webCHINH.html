<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý GPA & Điểm rèn luyện</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h2 {
      background: #007bff;
      color: white;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }

    h3 {
      margin-top: 24px;
      color: #007bff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-bottom: 16px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);

    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ccc;
      text-align: center;
    }

    th {
      background: #f7f9fb;
    }

    input[type="text"], input[type="number"], input[type="file"] {
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
      box-sizing: border-box;
      text-align: center;
    }

    button {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 5px;
    }

    button:hover {
      background-color: #218838;
    }

    td img {
      margin-top: 4px;
      border-radius: 4px;
      max-width: 50px;
      height: auto;
    }

    .danger {
      background-color: #dc3545;
    }

    .danger:hover {
      background-color: #c82333;
    }

    #gpaAccum, #totalRL {
      color: #dc3545;
      font-weight: bold;
    }

    #rank {
      font-weight: bold;
      color: #007bff;
    }

    .minh-chung {
      max-width: 150px;
    }

    .activity-btns {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    
    .proof-display img {
  transition: all 0.3s ease;
  cursor: pointer;
}

  </style>
</head>


<body>

<h2>🎓Phần tính GPA</h2>

<table id="gpaTable">
  <thead>
    <tr>
      <th style="width: 40px;">STT</th>
      <th>Môn</th>
      <th style="width: 60px;">Số TC</th>
      <th style="width: 60px;">Điểm QT</th>
      <th style="width: 60px;">Điểm CK</th>
      <th style="width: 60px;">Tỉ lệ QT (%)</th>
      <th style="width: 60px;">ĐTB (10)</th>
      <th style="width: 60px;">ĐTB (4)</th>
      <th style="width: 60px;" >Chữ</th>
      <th style="width: 60px;">Xóa</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<button onclick="addSubject()">➕Thêm môn</button>

<p><strong>📊GPA tích lũy:</strong> <span id="gpaAccum">0.00</span> / 4.00</p>

<p><strong>🏅Xếp loại:</strong> <span id="rank">Không</span></p>


<hr>

<h2>🏆Phần tính điểm rèn luyện</h2>
<p style="font-size:160%;"><strong>Tổng điểm:</strong> <span id="totalRL">0</span></p>
<div class="activity-btns">
  <button onclick="addActivityTo(0)">➕ Hoạt động Điều 1</button>
  <button onclick="addActivityTo(1)">➕ Hoạt động Điều 2</button>
  <button onclick="addActivityTo(2)">➕ Hoạt động Điều 3</button>
  <button onclick="addActivityTo(3)">➕ Hoạt động Điều 4</button>
</div>
<div id="rlContainer"></div>

<script>
function addSubject() {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td class="stt">1</td>
    <td><input type="text"></td>
    <td><input type="number" value="3" onchange="calculateGPA()"></td>
    <td><input type="number" value="0" onchange="calculateGPA()"></td>
    <td><input type="number" value="0" onchange="calculateGPA()"></td>
    <td><input type="number" value="50" onchange="calculateGPA()"></td>
    <td></td>
    <td></td>
    <td></td>
    <td><button class="danger" onclick="this.parentElement.parentElement.remove(); calculateGPA(); updateSubjectSTT()">X</button>
</td>
  `;
  document.querySelector("#gpaTable tbody").appendChild(row);
  updateSubjectSTT();
}

function updateSubjectSTT() {
  const rows = document.querySelectorAll("#gpaTable tbody tr");
  rows.forEach((row, index) => {
    const sttCell = row.querySelector(".stt");
    if (sttCell) sttCell.innerText = index + 1;
  });
}

function calculateGPA() {
  let total4 = 0, totalCredits = 0;

  document.querySelectorAll("#gpaTable tbody tr").forEach(row => {
    const cells = row.children;
    const tc = parseFloat(cells[2].querySelector("input").value) || 0;
    const qt = parseFloat(cells[3].querySelector("input").value) || 0;
    const ck = parseFloat(cells[4].querySelector("input").value) || 0;
    const ratioQT = parseFloat(cells[5].querySelector("input").value) || 0;
    const ratioCK = 100 - ratioQT;

    const avg10 = ((qt * ratioQT + ck * ratioCK) / 100).toFixed(2);
    const avg4 = convertTo4(avg10);
    const letter = convertToLetter(avg10);

    cells[6].innerText = avg10;
    cells[7].innerText = avg4.toFixed(2);
    cells[8].innerText = letter;

    total4 += avg4 * tc;
    totalCredits += tc;
  });

  const gpa = totalCredits > 0 ? (total4 / totalCredits).toFixed(2) : "0.00";
  document.getElementById("gpaAccum").innerText = gpa;
  document.getElementById("rank").innerText = rankGPA(gpa);
  updateSubjectSTT();
}

function convertTo4(score) {
  score = parseFloat(score);
  if (score >= 8.5) return 4;
  if (score >= 8.0) return 3.5;
  if (score >= 7.0) return 3;
  if (score >= 5.5) return 2;
  if (score >= 4.0) return 1;
  return 0;
}

function convertToLetter(score) {
  score = parseFloat(score);
  if (score >= 9.0) return "A+";
  if (score >= 8.5) return "A";
  if (score >= 8.0) return "B+";
  if (score >= 7.0) return "B";
  if (score >= 5.5) return "C";
  if (score >= 4.0) return "D";
  return "F";
}

function rankGPA(gpa) {
  gpa = parseFloat(gpa);
  if (gpa >= 3.6) return "👑 Xuất sắc";
  if (gpa >= 3.2) return "🏆Giỏi";
  if (gpa >= 2.5) return "🥈Khá";
  if (gpa >= 2.0) return "🥉Trung bình";
  return "😢Yếu";
}



// --- Rèn luyện ---
const rlTitles = ["Ý thức học tập", "Rèn luyện đạo đức", "Tham gia hoạt động", "Khác"];
const rlContainer = document.getElementById("rlContainer");

rlTitles.forEach((title, i) => {
  const section = document.createElement("div");
  section.innerHTML = `<h3>🎯Điều ${i+1}: ${title}</h3><table><thead><tr><th style="width: 40px;">STT</th><th>Hoạt động</th><th style="width: 60px;">Điểm</th><th style="width: 600px;">📎Link</th><th></th></tr></thead><tbody></tbody></table>`;
  rlContainer.appendChild(section);
});

function addActivityTo(index) {
  const tbody = rlContainer.children[index].querySelector("tbody");
  const row = document.createElement("tr");
  row.innerHTML = `
    <td class="stt-rl"></td>
    <td><input type="text"></td>
    <td><input type="number" value="0" onchange="calcRL()"></td>
    <td>
    <input type="text" class="minh-chung" placeholder="Link minh chứng" onchange="showProofLink(this)">
    <div class="proof-display"></div>
  </td>
    <td><button class="danger" onclick="this.parentElement.parentElement.remove(); calcRL(); updateRLSTT(${index})">X</button></td>


  `;
  tbody.appendChild(row);
  calcRL();

  updateRLSTT(index);
}
function updateRLSTT(index) {
  const tbody = rlContainer.children[index].querySelector("tbody");
  const rows = tbody.querySelectorAll("tr");
  rows.forEach((row, i) => {
    row.querySelector(".stt-rl").innerText = i + 1;
  });
}


function calcRL() {
  let total = 0;
  rlContainer.querySelectorAll("tbody tr").forEach(row => {
    const score = parseFloat(row.children[2].querySelector("input").value) || 0;
    total += score;
  });
  document.getElementById("totalRL").innerText = total;
}

function showProofLink(input) {
  const container = input.nextElementSibling;
  const link = input.value.trim();
  container.innerHTML = "";

  if (!link) return;

  // Nếu là ảnh
  if (link.match(/\.(jpeg|jpg|png|gif|webp)$/i)) {
    const img = document.createElement("img");
    img.src = link;
    img.style.maxWidth = "200px";
    img.style.borderRadius = "8px";
    img.style.marginTop = "6px";
    container.appendChild(img);
  } else {
    // Nếu là link thường
    const a = document.createElement("a");
    a.href = link;
    a.innerText = "🔗 Xem minh chứng";
    a.target = "_blank";
    a.style.color = "#007bff";
    a.style.display = "inline-block";
    a.style.marginTop = "6px";
    container.appendChild(a);
  }
}

</script>

</body>
</html>
